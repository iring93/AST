<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°å¤§é†«é™¢è‡¨åºŠåˆ†é›¢èŒæ ªæŠ—ç”Ÿç´ æ•æ„Ÿæ€§åœ–è­œæ¨¡æ“¬ä»‹é¢</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 + ReactDOM via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transform in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-yellow-50">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useMemo } = React;

      function Tag({ children }) {
        return (
          <span className="inline-flex items-center rounded-full border px-2 py-1 text-xs text-slate-700">
            {children}
          </span>
        );
      }

      function App() {
        const [startYm, setStartYm] = useState("2024-10");
        const [endYm, setEndYm] = useState("2025-03");
        const [hospitals, setHospitals] = useState({ main: true, children: false });
        const [taxaChecked, setTaxaChecked] = useState({});
        const [taxaQuery, setTaxaQuery] = useState("");

        const TAXA = [
          { id: "agp", label: "AEROBIC GRAM POSITIVE" },
          { id: "agn", label: "AEROBIC GRAM NEGATIVE" },
          { id: "an_b", label: "ANAEROBIC BACTERIA" },
          { id: "candida", label: "CANDIDA" },
        ];

        const SYMPTOMS = [
          { id: "unknown", label: "ä¸æŒ‡å®šéƒ¨ä½" },
          { id: "blood", label: "è¡€æµæ„ŸæŸ“" },
          { id: "urine", label: "æ³Œå°¿ç³»æ„ŸæŸ“" },
          { id: "lung", label: "è‚ºç‚" },
          { id: "surgical", label: "å‚·å£æ„ŸæŸ“" },
          { id: "abdominal", label: "è…¹è…”å…§æ„ŸæŸ“" },
        ];

        const [symptoms, setSymptoms] = useState({});
        const [onset, setOnset] = useState({
          community: false,
          noso_general: false,
          noso_icu: false,
        });

        const filteredTaxa = useMemo(() => {
          const q = taxaQuery.trim().toLowerCase();
          if (!q) return TAXA;
          return TAXA.filter((t) => t.label.toLowerCase().includes(q));
        }, [taxaQuery]);

        const allVisibleChecked = filteredTaxa.every((t) => !!taxaChecked[t.id]);

        function toggleAllVisible(next) {
          const on = typeof next === "boolean" ? next : !allVisibleChecked;
          const copy = { ...taxaChecked };
          filteredTaxa.forEach((t) => (copy[t.id] = on));
          setTaxaChecked(copy);
        }

        function clearAll() {
          setTaxaChecked({});
        }

        const selectionPreview = useMemo(() => {
          const taxa = TAXA.filter((t) => taxaChecked[t.id]).map((t) => t.label);
          const syms = SYMPTOMS.filter((s) => symptoms[s.id]).map((s) => s.label);
          const hosp = [
            hospitals.main ? "ç¸½é™¢" : null,
            hospitals.children ? "å…’ç«¥é†«é™¢" : null,
          ].filter(Boolean);
          const onsetTags = [
            onset.community ? "ç¤¾å€/é™¢å¤–" : null,
            onset.noso_general ? "ä½é™¢æ»¿2æ—¥ä¸€èˆ¬ç—…æˆ¿" : null,
            onset.noso_icu ? "ä½é™¢æ»¿2æ—¥ICU/åŠ è­·" : null,
          ].filter(Boolean);
          return { taxa, syms, hosp, onsetTags };
        }, [taxaChecked, symptoms, hospitals, onset]);

        function handleSubmit(e) {
          e.preventDefault();
          alert(
            "å·²é€å‡ºæŸ¥è©¢ï¼\\n\\n" +
            "æœŸé–“ï¼š" + startYm + " ~ " + endYm + "\\n" +
            "é†«é™¢ï¼š" + (selectionPreview.hosp.join("ã€") || "ï¼ˆæœªé¸ï¼‰") + "\\n" +
            "èŒç¾¤ï¼š" + (selectionPreview.taxa.join("ã€") || "ï¼ˆæœªé¸ï¼‰") + "\\n" +
            "ç—‡ç‹€ï¼š" + (selectionPreview.syms.join("ã€") || "ï¼ˆæœªé¸ï¼‰") + "\\n" +
            "æ„ŸæŸ“æ™‚é–“ï¼š" + (selectionPreview.onsetTags.join("ã€") || "ï¼ˆæœªé¸ï¼‰")
          );
        }

        return (
          <div className="min-h-screen p-6">
            <div className="mx-auto w-full max-w-5xl rounded-2xl border border-yellow-200 bg-white/70 shadow-sm">
              {/* Header èªªæ˜åˆ— */}
              <div className="border-b border-yellow-200 bg-blue-50/60 p-4 text-sm text-slate-700">
                <span className="inline-flex items-center gap-2 rounded-md bg-blue-100 px-2 py-1 text-blue-700">
                  è¨ˆç®—é‚è¼¯èªªæ˜
                </span>
                <span className="ml-2">
                  <p>åˆ†æ¯ï¼šåˆ†æä¹‹èŒç¨®/å±¬åŠæŠ—ç”Ÿç´ é …ç›®çµ„åˆæœ‰è—¥æ•è©¦é©—çµæœä¹‹èŒæ ªæ•¸ã€‚ åˆ†å­ï¼šåˆ†æ¯ä¸­æŠ—ç”Ÿç´ è—¥æ•è©¦é©—çµæœç‚º S ä¹‹èŒæ ªæ•¸ã€‚</p>
                  <p>æ•æ„Ÿæ€§ç™¾åˆ†æ¯” = åˆ†å­/åˆ†æ¯*100%ã€‚</p>
                  <p>åŒé™¢å€åŒç—…äººåŒæœŸé–“åŒèŒç¨®åŒæŠ—ç”Ÿç´ ï¼Œé¸æ“‡ç¬¬ä¸€ç­†æ¡æª¢æ—¥è³‡æ–™ï¼›è‹¥è©²æ¡æª¢æ—¥æœ‰å¤šç­†è³‡æ–™ï¼Œå‰‡ä¾è—¥æ•è©¦é©—çµæœR>I>SDD>Sä¹‹å„ªå…ˆé †åºé¸å–ã€‚</p>

                </span>
              </div>

              {/* å…§å®¹è¡¨å–® */}
              <form onSubmit={handleSubmit} className="p-6">
                {/* è³‡æ–™æœŸé–“ + é è¦½ */}
                <section className="grid grid-cols-1 gap-4 sm:grid-cols-3">
                  <div className="col-span-3 flex flex-wrap items-center gap-3">
                    <label className="text-sm font-medium text-slate-700">è³‡æ–™æœŸé–“</label>
                    <input
                      type="month"
                      value={startYm}
                      onChange={(e) => setStartYm(e.target.value)}
                      className="rounded-md border px-3 py-2 text-sm shadow-sm"
                    />
                    <span className="text-slate-500">è‡³</span>
                    <input
                      type="month"
                      value={endYm}
                      onChange={(e) => setEndYm(e.target.value)}
                      className="rounded-md border px-3 py-2 text-sm shadow-sm"
                    />
                    <span className="ml-2 text-xs text-slate-500">ï¼ˆé è¨­æœ€è¿‘6å€‹æœˆå…¨é™¢è‡¨åºŠæª¢é«”ä¹‹æŠ—ç”Ÿç´ æ„Ÿå—æ€§çµ±è¨ˆï¼‰</span>
                  </div>

                  <div className="col-span-3">
                    <div className="mt-3 w-full rounded-xl border bg-white/70 p-4 text-sm shadow-sm">
                      <div className="mb-1 font-medium text-slate-700">å·²é¸æ“‡æ¢ä»¶</div>
                      <div className="flex flex-wrap gap-2">
                        <Tag>æœŸé–“ï¼š{startYm}ï½{endYm}</Tag>
                        <Tag>é™¢å€ï¼š{selectionPreview.hosp.join("ã€") || "æœªé¸"}</Tag>
                        <Tag>
                          èŒç¾¤ï¼š{selectionPreview.taxa.length > 0 ? selectionPreview.taxa.join("ã€") : "æœªé¸"}
                        </Tag>
                        <Tag>
                          ç—‡ç‹€ï¼š{selectionPreview.syms.length > 0 ? selectionPreview.syms.join("ã€") : "æœªé¸"}
                        </Tag>
                        <Tag>
                          æ„ŸæŸ“æ™‚é–“ï¼š{selectionPreview.onsetTags.length > 0 ? selectionPreview.onsetTags.join("ã€") : "æœªé¸"}
                        </Tag>
                      </div>
                    </div>
                  </div>
                </section>

                {/* ä¸»é«”é›™æ¬„ */}
                <section className="mt-4 grid grid-cols-1 gap-6 lg:grid-cols-2">
                  {/* å·¦æ¬„ï¼šç´°èŒé¡å‹ */}
                  <div className="rounded-2xl border bg-yellow-50/60 p-4">
                    <div className="mb-1 text-sm text-slate-600">å¯è¤‡é¸ä¸‹åˆ—ç´°èŒé¡å‹é€²è¡Œåˆ†æ</div>
                    <div className="mb-3 flex items-center justify-between">
                      <div className="text-base font-semibold text-slate-800">
                        å…¨é™¢å„é¡ç´°èŒä¹‹æŠ—ç”Ÿç´ æ„Ÿå—æ€§
                        <span className="ml-1 align-top text-xs text-rose-500">ï¼Š</span>
                      </div>
                    </div>

                    {/* æœå°‹åˆ— */}
                    <div className="flex items-center gap-2">
                      <div className="relative flex-1">
                        <input
                          type="text"
                          value={taxaQuery}
                          onChange={(e) => setTaxaQuery(e.target.value)}
                          placeholder="æœå°‹æ¬²æŸ¥è©¢çš„èŒç¨®"
                          className="w-full rounded-lg border px-3 py-2 pr-10 text-sm shadow-sm focus:ring-2 focus:ring-blue-300"
                        />
                        <span className="pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-slate-400">ğŸ”</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <button
                          type="button"
                          className="rounded-md border bg-white px-2 py-1 text-xs text-slate-700 shadow-sm hover:bg-slate-50"
                          onClick={() => toggleAllVisible(true)}
                          title="å…¨é¸"
                        >
                          å…¨é¸
                        </button>
                        <button
                          type="button"
                          className="rounded-md border bg-white px-2 py-1 text-xs text-slate-700 shadow-sm hover:bg-slate-50"
                          onClick={clearAll}
                          title="æ¸…é™¤å…¨éƒ¨"
                        >
                          æ¸…é™¤å…¨éƒ¨
                        </button>
                      </div>
                    </div>

                    {/* æ¸…å–® */}
                    <ul className="mt-3 space-y-2">
                      {filteredTaxa.map((t) => (
                        <li key={t.id} className="flex items-start gap-2 rounded-lg border bg-white px-3 py-2 shadow-sm">
                          <input
                            id={"taxa-" + t.id}
                            type="checkbox"
                            checked={!!taxaChecked[t.id]}
                            onChange={(e) => setTaxaChecked((prev) => ({ ...prev, [t.id]: e.target.checked }))}
                            className="mt-0.5 h-4 w-4"
                          />
                          <label htmlFor={"taxa-" + t.id} className="cursor-pointer text-sm text-slate-800">
                            {t.label}
                          </label>
                        </li>
                      ))}
                      {filteredTaxa.length === 0 && (
                        <li className="rounded-lg border bg-white px-3 py-6 text-center text-sm text-slate-500">
                          ç„¡ç›¸ç¬¦é …ç›®
                        </li>
                      )}
                    </ul>
                  </div>

                  {/* å³æ¬„ï¼šé™¢å€ & é€²éšæ¢ä»¶ */}
                  <div className="rounded-2xl border bg-yellow-50/60 p-4">
                    {/* é™¢å€é¸æ“‡ */}
                    <div className="mb-4 rounded-xl border bg-white/70 p-4 shadow-sm">
                      <div className="text-base font-semibold text-slate-800">
                        é™¢å€é¸æ“‡ï¼ˆå¯è¤‡é¸ï¼‰<span className="ml-1 align-top text-xs text-rose-500">ï¼Š</span>
                      </div>
                      <div className="mt-1 text-sm text-slate-600">é¸æ“‡è¦åˆ†æçš„é™¢å€ï¼Œå¯åŒæ™‚é¸æ“‡å¤šå€‹é™¢å€é€²è¡Œè¨ˆç®—</div>
                      <div className="mt-3 grid grid-cols-2 gap-3 sm:w-2/3">
                        <label className="flex items-center gap-2 text-sm text-slate-800">
                          <input
                            type="checkbox"
                            checked={hospitals.main}
                            onChange={(e) => setHospitals((p) => ({ ...p, main: e.target.checked }))}
                            className="h-4 w-4"
                          />
                          ç¸½é™¢
                        </label>
                        <label className="flex items-center gap-2 text-sm text-slate-800">
                          <input
                            type="checkbox"
                            checked={hospitals.children}
                            onChange={(e) => setHospitals((p) => ({ ...p, children: e.target.checked }))}
                            className="h-4 w-4"
                          />
                          å…’ç«¥é†«é™¢
                        </label>
                      </div>
                    </div>

                    {/* é€²éšæ¢ä»¶ */}
                    <div className="grid grid-cols-1 gap-4 md:grid-cols-2">
                      {/* ç—…äººç—‡ç‹€ */}
                      <div className="rounded-xl border bg-white/70 p-4 shadow-sm">
                        <div className="text-base font-semibold text-slate-800">ç—…äººç—‡ç‹€</div>
                        <div className="mt-1 text-sm text-slate-600">é¸æ“‡å¾Œï¼Œæ„Ÿå—æ€§ç™¾åˆ†æ¯”å°‡åªè¨ˆç®—è©²é¸æ“‡éƒ¨ä½ä¹‹æª¢é«”</div>
                        <div className="mt-2 space-y-3">
                          {SYMPTOMS.map((s) => (
                            <label key={s.id} className="flex items-center gap-2 text-sm text-slate-800">
                              <input
                                type="checkbox"
                                checked={!!symptoms[s.id]}
                                onChange={(e) => setSymptoms((prev) => ({ ...prev, [s.id]: e.target.checked }))}
                                className="h-4 w-4"
                              />
                              {s.label}
                            </label>
                          ))}
                        </div>
                      </div>

                      {/* æ„ŸæŸ“æ™‚é–“ */}
                      <div className="rounded-xl border bg-white/70 p-4 shadow-sm">
                        <div className="text-base font-semibold text-slate-800">æ„ŸæŸ“æ™‚é–“ï¼ˆå¯è¤‡é¸ï¼‰</div>
                        <div className="mt-1 text-sm text-slate-600">å¯é¸æ“‡å¤šå€‹æ„ŸæŸ“æ™‚é–“é€²è¡Œè¨ˆç®—</div>
                        <div className="mt-2 space-y-3 text-sm">
                          <label className="flex items-center gap-2 text-slate-800">
                            <input
                              type="checkbox"
                              checked={onset.community}
                              onChange={(e) => setOnset((p) => ({ ...p, community: e.target.checked }))}
                              className="h-4 w-4"
                            />
                            ç¤¾å€/é™¢å¤–æ„ŸæŸ“
                          </label>
                          <label className="flex items-center gap-2 text-slate-800">
                            <input
                              type="checkbox"
                              checked={onset.noso_general}
                              onChange={(e) => setOnset((p) => ({ ...p, noso_general: e.target.checked }))}
                              className="h-4 w-4"
                            />
                            å…¥é™¢æ»¿2æ—¥ä¸”æ„ŸæŸ“æ–¼ä¸€èˆ¬ç—…æˆ¿
                          </label>
                          <label className="flex items-center gap-2 text-slate-800">
                            <input
                              type="checkbox"
                              checked={onset.noso_icu}
                              onChange={(e) => setOnset((p) => ({ ...p, noso_icu: e.target.checked }))}
                              className="h-4 w-4"
                            />
                            å…¥é™¢æ»¿2æ—¥ä¸”æ„ŸæŸ“æ–¼åŠ è­·ç—…æˆ¿
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>

                {/* åº•éƒ¨ï¼šå‹•ä½œ */}
                <section className="mt-6 flex justify-center">
                  <button type="submit" className="rounded-xl bg-amber-500 px-6 py-2 text-white shadow transition hover:bg-amber-600">
                    ç¢ºå®š
                  </button>
                </section>

                <div className="mt-6 border-t pt-4 text-xs text-slate-500">
                  åƒè€ƒï¼šClinical and Laboratory Standards Institute (CLSI) M100 S34 è¡¨å‹èˆ‡æ„Ÿå—æ€§å®šç¾©è¨»é‡‹ï¼ˆæ¨¡æ“¬ç•«é¢ï¼Œéå¯¦éš›é†«å›‘ç³»çµ±ï¼‰
                </div>
              </form>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
